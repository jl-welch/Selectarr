!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).selectarr=e()}(this,function(){"use strict";function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var a="data-selectarr",l="data-selectarr-list",c="data-selectarr-item",r="data-selectarr-value",u="input",_="list",h="open",d="item",m="item--active",i=function(){function s(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"[".concat(a,"]"),e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s),this._keyDownHandler=this._keyDownHandler.bind(this),this._applyValueAndCloseList=this._applyValueAndCloseList.bind(this),this._mouseEnter=this._mouseEnter.bind(this),this._input=document.querySelector(t),this._hiddenInput=document.createElement("input"),this._list=document.createElement("ul"),this._class=e.class||"selectarr",this._limit=s._setLimit(e.limit),this._items=e.items,this._index=-1,this._length=null,this._init()}var t,e,i;return t=s,i=[{key:"_getLabelFromItem",value:function(t){return"string"==typeof t?t:t.label?t.label:t.value}},{key:"_removeList",value:function(){var t=document.querySelector("[".concat(l,"].").concat(h));t&&(t.classList.remove(h),t.innerHTML="")}},{key:"_setLimit",value:function(t){return t&&0<+t?+t:5}}],(e=[{key:"removeActive",value:function(){var t=this._list.querySelector(".".concat(this._class,"__").concat(m));t&&t.classList.remove("".concat(this._class,"__").concat(m))}},{key:"_init",value:function(){var t=document.createElement("div");t.className=this._class,this._input.parentElement.replaceChild(t,this._input),this._hiddenInput.name=this._input.name,this._hiddenInput.type="hidden",this._input.className="".concat(this._class,"__").concat(u),this._input.removeAttribute("name"),this._input.addEventListener("keyup",this._keyDownHandler),this._list.className="".concat(this._class,"__").concat(_),this._list.setAttribute(l,""),this._list.addEventListener("click",this._applyValueAndCloseList),t.appendChild(this._input),t.appendChild(this._hiddenInput),t.appendChild(this._list)}},{key:"_applyValueAndCloseList",value:function(t){var e=t.target.closest("[".concat(c,"]"))||this._list.querySelector("[".concat(c,'="').concat(this._index,'"]'));e&&(this._input.value=e.textContent,this._hiddenInput.value=e.getAttribute(r),this._index=-1,s._removeList())}},{key:"_updateActiveItemState",value:function(){var t=this._list.querySelectorAll("[".concat(c,"]"));t.length&&(this.removeActive(),t[this._index].classList.add("".concat(this._class,"__").concat(m)))}},{key:"_mouseEnter",value:function(t){var e=t.target.closest("[".concat(c,"]"));e&&(this._index=e.getAttribute(c),this._updateActiveItemState())}},{key:"_populateListItems",value:function(t){var s,a=this;this._length=t.length-1,t.forEach(function(t,e){var i,n=null;i="object"===o(t)?(n=t.label,t.value):n=t,(s=document.createElement("li")).textContent=n,s.className="".concat(a._class,"__").concat(d),s.setAttribute(r,i),s.setAttribute(c,e),s.addEventListener("mouseenter",a._mouseEnter),a._list.appendChild(s),a._list.classList.add(h)})}},{key:"_match",value:function(e){return this._items.filter(function(t){return s._getLabelFromItem(t).match(e)}).sort(function(t,e){var i=s._getLabelFromItem(t),n=s._getLabelFromItem(e);return i<n?-1:n<i?1:0})}},{key:"_search",value:function(){if(this._index=-1,s._removeList(),this._input.value){var t=new RegExp(this._input.value,"gi"),e=this._match(t).slice(0,this._limit);e.length&&this._populateListItems(e)}}},{key:"_keyDownHandler",value:function(t){var e=t.key;return"ArrowUp"===e||"ArrowDown"===e?("ArrowUp"===e&&0<this._index&&this._index--,"ArrowDown"===e&&this._index<this._length&&this._index++,void this._updateActiveItemState()):"Enter"!==e?"Escape"===e?(this._index=-1,void s._removeList()):void this._search():void(-1!==this._index&&this._applyValueAndCloseList(t))}}])&&n(t.prototype,e),i&&n(t,i),s}();return document.addEventListener("click",function(t){var e=t.target.closest("[".concat(a,"]"));(e?e.parentElement.querySelector("[".concat(l,"].").concat(h)):null)||i._removeList()}),i});