!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).selectarr=t()}(this,function(){"use strict";function l(e){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var a="data-selectarr",r="data-selectarr-list",o="data-selectarr-item",c="data-selectarr-value",h="input",u="list",_="open",d="item",m="active",i=function(){function s(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"[".concat(a,"]"),t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),"string"!=typeof e)throw new Error("Type of element selector must be a string.");if("object"!==l(t))throw new Error("Options must be an object.");if(this._search=this._search.bind(this),this._applyValue=this._applyValue.bind(this),this._mouseEnter=this._mouseEnter.bind(this),this._element=document.querySelector(e),!this._element)throw new Error("Cannot find element: ".concat(e));if(this._items=t.items,!this._items)throw new Error("Items does not exist: ".concat(this._items,". Please pass an array of items to the options object."));this._list=document.createElement("ul"),this._index=-1,this._limit=this.setLimit(),this._class=t.class||"selectarr",this._hidden=null,this._wrapper=null,this._length=null,this._init()}var e,t,i;return e=s,i=[{key:"_removeList",value:function(){var e=document.querySelector("[".concat(r,"].").concat(_));e&&(e.classList.remove(_),e.innerHTML="")}}],(t=[{key:"addActive",value:function(){this.removeActive();var e=this._list.querySelectorAll("[".concat(o,"]"));if(!e.length||this._index<0||this._index>e.length)return null;e[this._index].classList.add("".concat(this._class,"-").concat(m))}},{key:"removeActive",value:function(){var e=this._list.querySelector(".".concat(this._class,"-").concat(m));e&&e.classList.remove("".concat(this._class,"-").concat(m))}},{key:"setLimit",value:function(e){return e&&0<+e?+e:10}},{key:"_init",value:function(){this._wrapper=document.createElement("div"),this._wrapper.className=this._class,this._element.parentElement.replaceChild(this._wrapper,this._element),this._hidden=document.createElement("input"),this._hidden.className="".concat(this._class,"-").concat(h),this._hidden.name=this._element.name,this._hidden.type="hidden",this._element.removeAttribute("name"),this._element.addEventListener("keyup",this._search),this._list.className="".concat(this._class,"-").concat(u),this._list.setAttribute(r,""),this._list.addEventListener("click",this._applyValue),this._wrapper.appendChild(this._element),this._wrapper.appendChild(this._hidden),this._wrapper.appendChild(this._list)}},{key:"_applyValue",value:function(e){var t=e.target.closest("[".concat(o,"]"))||this._list.querySelector("[".concat(o,'="').concat(this._index,'"]'));if(!t)return null;this._element.value=t.textContent,this._hidden.value=t.getAttribute(c),s._removeList()}},{key:"_populateList",value:function(e){var s,a=this;this._length=e.length-1,e.forEach(function(e,t){var i,n=null;i="object"===l(e)?(n=e.label||e.value,e.value||e.label):n=e,(s=document.createElement("li")).textContent=n,s.className="".concat(a._class,"-").concat(d),s.setAttribute(c,i),s.setAttribute(o,t),s.addEventListener("mouseenter",a._mouseEnter),a._list.appendChild(s),a._list.classList.add(_)})}},{key:"_match",value:function(t){return this._items.filter(function(e){return("string"==typeof e?e:e.label?e.label:e.value).match(t)}).sort(function(e,t){var i="string"==typeof e?e:e.label?e.label:e.value,n="string"==typeof t?t:t.label?t.label:t.value;i.localeCompare(n)})}},{key:"_search",value:function(e){var t=e.key;if("ArrowUp"===t||"ArrowDown"===t||"Enter"===t)return this._key(e,e.key);if(s._removeList(),this._index=-1,!this._element.value.length)return null;var i=new RegExp(this._element.value,"gi"),n=this._match(i).slice(0,this._limit);n.length&&this._populateList(n)}},{key:"_key",value:function(e){this["_key".concat(e.key)](e),"Enter"!==e.key&&this.addActive()}},{key:"_keyArrowUp",value:function(){0<this._index&&this._index--}},{key:"_keyArrowDown",value:function(){this._index<this._length&&this._index++}},{key:"_keyEnter",value:function(e){if(-1===this._index)return null;this._applyValue(e,this._index),this._index=-1}},{key:"_mouseEnter",value:function(e){var t=e.target.closest("[".concat(o,"]"));t&&(this._index=parseInt(t.getAttribute(o),10)),this.addActive()}}])&&n(e.prototype,t),i&&n(e,i),s}();return document.addEventListener("click",function(e){var t=e.target.closest("[".concat(a,"]"));if(t?t.parentElement.querySelector("[".concat(r,"].").concat(_)):null)return null;i._removeList()}),i});